{% extends 'base.html' %}

{% block content %}
    <span class="title"><h1>{% block title %} Home {% endblock %}</h1></span>
    {%if status == True %}
                <h1>Welcome, {{ user.fullname }}</h1>
            {% else %}
                <h1>Welcome</h1>
            {% endif %}
    <div class="main-container">
        <div class="user-info">
            {% if status == True %}
                <p>{{ user.fullname }}</p>
                <p>Events organized: {{ user.events_organized|length }}</p>
                <p>Events attended: {{ user.events_attended|length }}</p>
                <p>Events volunteered: {{ user.events_participated|length }}</p>
                <p>Volunteer hours: Coming soon</p>
            {% else %}
                <h4>Not Logged In</h4>
            {% endif %}
        </div>
        <div id="events">
            {% for event in events %}
                <div class="event">
                    <a href="{{ url_for('event', event_id=event.id) }}"><h3 class="event-title">{{ event.event_name }}</h3></a>
                    <p>Date: {{ event.date }}</p>
                    {% if user_id == event.organizer_id %}
                        <p>Organizer: {{ user.fullname }} (You)</p>
                    {% else %}    
                        <p>Organizer: {{ users.query.get_or_404(event.organizer_id).fullname }}</p>
                    {% endif %}
                    <p>Description <br> {{ event.description }}</p>
                    {% if event.type[:9] == "volunteer" %}
                        <div class="volunteers">Volunteers: ({{ event.volunteers|length }})
                            <button><a href="{{ url_for('volunteer', event_id=event.id) }}"> Sign up to Volunteer</a></button>
                            <br>
                            <table class="volunteer-table">
                                <thead>
                                    <th>Name</th>
                                    <th>Type</th>
                                </thead>
                                {% for volunteer in event.volunteers %}
                                    <tr>
                                        <td>Full Name></td>
                                        <td>{{ volunteer.type }}</td>
                                    </tr>
                                {% endfor %}
                            </table>
                        </div>
                    {% endif %}
                    {% if event.type[:11] == "participate" or event.type[10:] == "participate" %}
                        <div class="participants">Participants: ({{ event.attendees|length }})
                            <button><a href="{{ url_for('attend', event_id=event.id) }}"> RSVP to Attend</a></button>
                            <br>
                            <table class="volunteer-table">
                                <thead>
                                    <th>Name</th>
                                </thead>
                                {% for participant in event.attendees %}
                                    <tr>
                                        <td>Full Name</td>
                                    </tr>
                                {% endfor %}
                            </table>
                        </div>
                    {% endif %}
                    {% if event.organizer_id == user_id or user.role == "Admin" %}
                        <div class="card-actions">
                            <form class="delete" method="POST" action="{{ url_for('delete_event', event_id=event.id) }}">
                                <button id="d-s" type="submit">Delete</button>
                            </form>
                        <button class="edit"><a href="{{ url_for('edit_event', event_id=event.id) }}">Edit Event</a></button>
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
        <div class="more-info">
            <h3>All events</h3>
            <div>
                {% for event in events %}
                    <a class="event-link" href="{{ url_for('event', event_id=event.id) }}">{{event.event_name }}</a>
                {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}
